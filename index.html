
<!DOCTYPE html>
<html>
   <head>
      <title>Compound Game</title>
   </head>

   <body>
       <div id= 'InitialScreen'>
        <h1>Compound Game</h1>
    
            <div class="buttons">
                <input type = 'text' placeholder="Enter Player Name" id='nameInput'/>
                <br><br>
                <button onclick = "createButtonClicked()">CREATE</button>
                <div>OR</div>
                <div>
                    <input type='text' placeholder = 'Enter Room Id' id = 'roomIdInput'/>
                    <button onclick ="joinButtonClicked()">JOIN</button>
                </div>
                
                
            </div>
        </div>

        <div id= 'waitingRoomforHost' style="display:none">
            <h1>Compound Game Waiting Room</h1>
            <p id="gameId"> </p>
            <h2> The game room Id is <span id = "gameCodeDisplay"></span></h2>
            <p id='userJoin'> </p>
            <input type='text' placeholder = 'Max Players' id = 'MaxPlayerInput'/>
            <input type='text' placeholder = 'Number of Rounds' id = 'RoundInput'/>
            <input type='text' placeholder = 'Round Timer' id = 'RoundTimerInput'/>


            <button onclick='startGameButtonClicked()'>Start Game</button>
           

        </div>

        <div id= 'waitingRoomforPlayer' style="display:none">
            <h1>Compound Game Waiting Room</h1>
            <p id = 'displayRoom'></p>
        </div>

        <div id = 'example' style="display:none">
            <h3>Example</h3>
        </div>
        <p id = 'playerJoin'></p>
        
        <script src= "/socket.io/socket.io.js"></script>

        <!--initialize socket object so clients can establish connections-->
        <script>
            //var socket = io('/my-namespcae');
            let playerNumber = 0;
            var socket = io();
            const gameCodeDisplay = document.getElementById('gameCodeDisplay');
            const roomInput= document.getElementById('roomIdInput');

            //on connection to server, ask for user's name with an anonymous callback
            socket.on('connect', function(){
                // call the server-side function 'adduser' and send one parameter (value of prompt)
                
                document.getElementById('waitingRoomforPlayer').style.display='none';
                document.getElementById('waitingRoomforHost').style.display = 'none';
                document.getElementById('example').style.display = 'none';
                document.getElementById('InitialScreen').style.display = 'block';
                //socket.emit('adduser', prompt("What's your name?"));
            });

            function createButtonClicked(){
                console.log('create button clicked');
                const nameInput = document.getElementById('nameInput').value;
                socket.emit('createClicked',nameInput);
                init();
                
            }
            
            function joinButtonClicked(){
                const joinRoomId = roomInput.value;
                const nameInput = document.getElementById('nameInput').value;
                console.log('join button clicked' + joinRoomId);
                socket.emit('joinClicked',joinRoomId,nameInput);
                init();
            }

            function startGameButtonClicked(){
                const maxPlayer =document.getElementById('MaxPlayerInput').value;
                const roundInput =document.getElementById('RoundInput').value;
                const roundTimer =document.getElementById('RoundTimerInput').value;
            
                socket.emit('startGame',roomInput.value,maxPlayer, roundInput,roundTimer);
            }

            function init(){
                console.log('button clicked');
                // document.getElementById('InitialScreen').style.display = 'none';
                // document.getElementById('waitingRoomforHost').style.display = 'block';
                
            }

            function reset(){
                playerNumber = null;
                roomInput.value = '';
                gameCodeDisplay.innerText = '';
                document.getElementById('InitialScreen').style.display = 'block';
                document.getElementById('waitingRoomforHost').style.display = 'none';
            }

            socket.on('gameRoomNo', function(data){
                document.getElementById('InitialScreen').style.display = 'none';
                document.getElementById('waitingRoomforPlayer').style.display='none';
                document.getElementById('waitingRoomforHost').style.display = 'block';
                gameCodeDisplay.innerHTML =  data + ' .';
            });

            socket.on('errorRoomId',function(){
                reset();
                alert('Unknown game code');
            });
            
            socket.on('tooManyPlayers',function(){
                reset();
                alert('Room full');
            });

            socket.on('init',function(number){
                playerNumber = number;
            });

            socket.on('broadcastJoined',function(username){
                console.log('player joined');
                var br = document.createElement("br");
                document.getElementById("playerJoin").appendChild(br);
                document.getElementById("playerJoin").appendChild(document.createTextNode(username+ '  has joined!'));
                
            })

            socket.on('waitingRoomforPlayer',function(roomId){
                document.getElementById('InitialScreen').style.display ='none';
                document.getElementById('waitingRoomforPlayer').style.display = 'block';
                document.getElementById('waitingRoomforHost').style.display='none';
                document.getElementById('displayRoom').innerText= 'You are in room '+ roomId + '! Waiting for host to start game...'
            })
            //    socket.on('newclientconnect',function(data){
            //        document.body.innerHTML = '';
            //        document.write(data.description);
            //    });

            //    socket.on('connectToRoom',function(data){
            //        document.body.innerHTML = '';
            //        document.write(data);
            //    })

            // socket.on('updateusers',function(data){
            //     //document.getElementById("userJoin").innerHTML = data + ' has joined.';
            // });

            // socket.on('connect_failed', function(){
            //     document.write("sorry, issue with connection.");
            // })
        </script>

    </body>
   
</html>
